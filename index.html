<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Firm Social Scheduler</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#374151; --text:#e5e7eb;
      --accent:#22c55e; --accent2:#3b82f6; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:var(--text); background:linear-gradient(180deg,#0a0f20,var(--bg));
      min-height:100vh; padding:20px;
    }
    header, main { max-width:1100px; margin:0 auto; }
    header{
      display:flex; align-items:center; gap:16px; justify-content:space-between; margin-bottom:16px;
    }
    .brand { display:flex; align-items:center; gap:10px; }
    .logo { width:32px; height:32px; border-radius:8px; background:#1f2937; display:grid; place-items:center; font-weight:700; color:#93c5fd }
    .card{
      background:var(--panel); border:1px solid #1f2937; border-radius:12px; padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .grid{
      display:grid; gap:16px; grid-template-columns:1.3fr 1fr;
    }
    @media (max-width:980px){ .grid{ grid-template-columns:1fr } }
    h1,h2{ margin:0; font-weight:700; }
    h1{ font-size:22px } h2{ font-size:16px; opacity:.9 }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .field{ display:grid; gap:6px }
    label{ font-size:13px; color:#cbd5e1 }
    input[type="text"],input[type="datetime-local"],input[type="date"],select,textarea{
      width:100%; background:#0b1220; border:1px solid var(--muted); color:var(--text);
      border-radius:10px; padding:10px 12px; font-size:14px; outline:none; transition:border-color 120ms ease;
    }
    textarea{ min-height:120px; resize:vertical }
    input:focus,select:focus,textarea:focus{ border-color:var(--accent2) }
    .muted{ color:#93a4b8; font-size:12px }
    .counter{ font-size:12px; color:#cbd5e1 }
    .btn{
      appearance:none; background:linear-gradient(92deg,var(--accent),#16a34a);
      color:#052e1a; font-weight:700; border:none; border-radius:10px; padding:10px 14px;
      cursor:pointer; box-shadow:0 8px 20px rgba(34,197,94,.25); transition:transform 80ms ease,box-shadow 120ms ease,opacity 120ms ease;
    }
    .btn:hover{ transform:translateY(-1px) }
    .btn.secondary{ background:linear-gradient(92deg,var(--accent2),#2563eb); color:#081a37; box-shadow:0 8px 20px rgba(59,130,246,.25) }
    .btn.warn{ background:linear-gradient(92deg,var(--warn),#d97706); color:#2b1f0c }
    .btn.danger{ background:linear-gradient(92deg,var(--danger),#dc2626); color:#2b0c0c }
    .pill-group{ display:flex; gap:8px; flex-wrap:wrap }
    .pill{
      display:flex; gap:8px; align-items:center; border:1px dashed var(--muted);
      padding:8px 10px; border-radius:999px; cursor:pointer; transition:border-color 120ms ease,background 120ms ease;
    }
    .pill:hover{ border-color:#4b5563; background:#0d1528 }
    .pill input{ accent-color:var(--accent2) }
    .preview{ border:1px dashed #293447; border-radius:10px; padding:12px; background:#0c1322; display:grid; gap:8px }
    .list{ display:grid; gap:10px; max-height:60vh; overflow:auto; padding-right:4px }
    .item{ border:1px solid #213046; border-radius:10px; padding:12px; background:#0c1322; display:grid; gap:8px }
    .item .meta{ display:flex; justify-content:space-between; gap:8px; font-size:12px; color:#cbd5e1; flex-wrap:wrap }
    .badge{ display:inline-flex; gap:6px; align-items:center; background:#0f1a33; border:1px solid #213046; border-radius:999px; padding:4px 8px; font-size:12px; color:#cbd5e1 }
    .badges{ display:flex; gap:6px; flex-wrap:wrap }
    .status.draft{ color:#93a4b8 } .status.pending{ color:#fcd34d } .status.approved{ color:#86efac } .status.scheduled{ color:#60a5fa } .status.posted{ color:#c084fc } .status.rejected{ color:#fda4af }
    .tabs{ display:flex; gap:8px; margin-bottom:8px }
    .tab{ background:#0b1220; border:1px solid #1f2937; color:#cbd5e1; border-radius:999px; padding:6px 10px; cursor:pointer }
    .tab.active{ border-color:#2563eb; color:#e5e7eb }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">S</div>
      <div>
        <h1>Firm Social Scheduler</h1>
        <div class="muted" id="tz-label"></div>
      </div>
    </div>
    <div class="row">
      <select id="teamSelect" title="Team">
        <option value="Marketing">Marketing</option>
        <option value="HR">HR</option>
        <option value="Product">Product</option>
      </select>
      <select id="userSelect" title="User">
        <option>Sneha</option>
        <option>Ankit</option>
        <option>Priya</option>
      </select>
      <select id="roleSelect" title="Role">
        <option value="Creator">Creator</option>
        <option value="Reviewer">Reviewer</option>
        <option value="Admin">Admin</option>
      </select>
    </div>
  </header>

  <main class="grid" aria-label="Social scheduler">
    <!-- Composer -->
    <section class="card" aria-labelledby="composer-title">
      <h2 id="composer-title">Compose, template, and schedule</h2>

      <div class="row" style="justify-content:space-between">
        <div class="row">
          <button class="btn secondary" id="loadTemplateBtn" type="button">Load template</button>
          <button class="btn secondary" id="saveTemplateBtn" type="button">Save as template</button>
          <button class="btn secondary" id="importCsvBtn" type="button">Import CSV</button>
          <input type="file" id="csvFile" accept=".csv" style="display:none" />
        </div>
        <div class="row">
          <label class="sr-only" for="campaign">Campaign</label>
          <input id="campaign" type="text" placeholder="Campaign tag (e.g., Q4-Launch)" />
        </div>
      </div>

      <div class="field" style="margin-top:8px">
        <label for="content">Post content</label>
        <textarea id="content" placeholder="Hook, value, CTA… keep it crisp."></textarea>
        <div class="row" style="justify-content:space-between">
          <span class="muted">Tip: Add a short CTA. Use #hashtags thoughtfully.</span>
          <span id="content-count" class="counter">0 / 280</span>
        </div>
      </div>

      <div class="field">
        <label>Platforms</label>
        <div class="pill-group" role="group" aria-label="Platforms">
          <label class="pill"><input type="checkbox" value="Facebook"> Facebook</label>
          <label class="pill"><input type="checkbox" value="Twitter"> Twitter/X</label>
          <label class="pill"><input type="checkbox" value="Instagram"> Instagram</label>
          <label class="pill"><input type="checkbox" value="LinkedIn"> LinkedIn</label>
          <label class="pill"><input type="checkbox" value="YouTube"> YouTube</label>
          <label class="pill"><input type="checkbox" value="Threads"> Threads</label>
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:1">
          <label for="schedule">Schedule date & time</label>
          <input id="schedule" type="datetime-local" />
          <span class="muted">Must be future time. Uses your local timezone.</span>
        </div>
        <div class="field" style="flex:1">
          <label for="recurrence">Recurrence</label>
          <select id="recurrence">
            <option value="none">None</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
          <span class="muted">Creates repeating posts up to an end date.</span>
        </div>
        <div class="field" style="flex:1">
          <label for="repeatEnd">Repeat end date</label>
          <input id="repeatEnd" type="date" />
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:1">
          <label for="image">Optional image URL</label>
          <input id="image" type="text" placeholder="https://…/banner.jpg" />
        </div>
        <div class="field" style="flex:1">
          <label for="ctaLink">Optional CTA link</label>
          <input id="ctaLink" type="text" placeholder="https://your-site.com/landing" />
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:1">
          <label for="tags">Internal tags</label>
          <input id="tags" type="text" placeholder="product, hiring, launch" />
        </div>
        <div class="field" style="flex:1">
          <label for="approval">Approval route</label>
          <select id="approval">
            <option value="None">None</option>
            <option value="TeamLead">Team Lead</option>
            <option value="Brand">Brand</option>
            <option value="Compliance">Compliance</option>
          </select>
        </div>
      </div>

      <div class="preview" aria-live="polite">
        <strong>Preview</strong>
        <div id="preview-text" class="muted">Your post preview appears here.</div>
        <div id="preview-image" class="muted"></div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="submitBtn" class="btn">Submit for approval</button>
        <button id="scheduleBtn" class="btn secondary">Schedule directly</button>
        <button id="clearBtn" class="btn warn" type="button">Clear</button>
      </div>
      <div id="formError" class="muted" role="alert" style="margin-top:6px"></div>
    </section>

    <!-- Queue / workflow -->
    <section class="card" aria-labelledby="queue-title">
      <div class="row" style="justify-content:space-between">
        <h2 id="queue-title">Workflow & queue</h2>
        <div class="tabs">
          <button class="tab active" data-filter="all">All</button>
          <button class="tab" data-filter="draft">Draft</button>
          <button class="tab" data-filter="pending">Pending</button>
          <button class="tab" data-filter="approved">Approved</button>
          <button class="tab" data-filter="scheduled">Scheduled</button>
        </div>
      </div>
      <div class="list" id="queue"></div>
      <div class="row" style="margin-top:8px">
        <button id="exportBtn" class="btn secondary" type="button">Export JSON</button>
        <button id="purgeBtn" class="btn danger" type="button">Clear queue</button>
      </div>
    </section>
  </main>

  <script>
    // Elements
    const contentEl = document.getElementById('content');
    const imageEl = document.getElementById('image');
    const ctaLinkEl = document.getElementById('ctaLink');
    const scheduleEl = document.getElementById('schedule');
    const recurrenceEl = document.getElementById('recurrence');
    const repeatEndEl = document.getElementById('repeatEnd');
    const approvalEl = document.getElementById('approval');
    const tagsEl = document.getElementById('tags');
    const campaignEl = document.getElementById('campaign');
    const contentCountEl = document.getElementById('content-count');
    const previewTextEl = document.getElementById('preview-text');
    const previewImageEl = document.getElementById('preview-image');
    const tzLabel = document.getElementById('tz-label');
    const formError = document.getElementById('formError');
    const queueEl = document.getElementById('queue');
    const submitBtn = document.getElementById('submitBtn');
    const scheduleBtn = document.getElementById('scheduleBtn');
    const clearBtn = document.getElementById('clearBtn');
    const exportBtn = document.getElementById('exportBtn');
    const purgeBtn = document.getElementById('purgeBtn');
    const teamSelect = document.getElementById('teamSelect');
    const userSelect = document.getElementById('userSelect');
    const roleSelect = document.getElementById('roleSelect');
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const platformInputs = Array.from(document.querySelectorAll('.pill-group input[type="checkbox"]'));
    const csvFile = document.getElementById('csvFile');
    const loadTemplateBtn = document.getElementById('loadTemplateBtn');
    const saveTemplateBtn = document.getElementById('saveTemplateBtn');
    const importCsvBtn = document.getElementById('importCsvBtn');

    // Char limits (guidance)
    const LIMITS = { default: 280, Facebook: 63206, Instagram: 2200, LinkedIn: 3000, YouTube: 1500, Threads: 500, Twitter: 280 };

    // Timezone
    try { tzLabel.textContent = `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`; } catch { tzLabel.textContent = 'Timezone: Local'; }

    // Storage
    const loadQueue = () => { try { return JSON.parse(localStorage.getItem('firm.scheduler.queue')||'[]'); } catch { return []; } };
    const saveQueue = q => localStorage.setItem('firm.scheduler.queue', JSON.stringify(q));
    let queue = loadQueue();

    const loadTemplates = () => { try { return JSON.parse(localStorage.getItem('firm.scheduler.templates')||'[]'); } catch { return []; } };
    const saveTemplates = t => localStorage.setItem('firm.scheduler.templates', JSON.stringify(t));
    let templates = loadTemplates();

    // Helpers
    const getPlatforms = () => platformInputs.filter(x=>x.checked).map(x=>x.value);
    const effectiveLimit = (platforms) => platforms.length ? platforms.reduce((m,p)=>Math.min(m, LIMITS[p]||LIMITS.default), LIMITS.default) : LIMITS.default;
    const fmtDate = iso => new Date(iso).toLocaleString([], { dateStyle:'medium', timeStyle:'short' });
    const sanitize = s => s.replace(/</g,'&lt;').replace(/>/g,'&gt;');
    const uid = () => (crypto.randomUUID && crypto.randomUUID()) || `${Date.now()}-${Math.random().toString(16).slice(2)}`;

    function updatePreview(){
      const platforms = getPlatforms();
      const limit = effectiveLimit(platforms);
      const text = contentEl.value.trim();
      contentCountEl.textContent = `${text.length} / ${limit}`;
      contentCountEl.style.color = text.length > limit ? 'var(--warn)' : '#cbd5e1';
      previewTextEl.innerHTML = text ? sanitize(text).replace(/\n/g,'<br>') : 'Your post preview appears here.';
      const imgUrl = imageEl.value.trim();
      if(imgUrl){
        previewImageEl.innerHTML = `<img src="${imgUrl}" alt="Preview image" style="max-width:100%; border-radius:8px; border:1px solid #213046;" onerror="this.parentElement.textContent='Image failed to load'; this.remove();">`;
      }else{
        previewImageEl.textContent = '';
      }
    }

    contentEl.addEventListener('input', updatePreview);
    imageEl.addEventListener('input', updatePreview);
    platformInputs.forEach(el => el.addEventListener('change', updatePreview));

    function validateBase(){
      formError.textContent = '';
      const platforms = getPlatforms();
      const text = contentEl.value.trim();
      if(!text){ formError.textContent = 'Post content cannot be empty.'; return false; }
      if(!platforms.length){ formError.textContent = 'Select at least one platform.'; return false; }
      const limit = effectiveLimit(platforms);
      if(text.length > limit){ formError.textContent = `Content exceeds guidance limit (${text.length} > ${limit}).`; return false; }
      return true;
    }

    function validateSchedule(){
      const when = scheduleEl.value;
      if(!when){ formError.textContent = 'Select a date and time.'; return false; }
      const dt = new Date(when), now = new Date();
      if(isNaN(dt.getTime()) || dt <= now){ formError.textContent = 'Schedule time must be in the future.'; return false; }
      return true;
    }

    function buildItem(status, when){
      const item = {
        id: uid(),
        content: contentEl.value.trim(),
        image: imageEl.value.trim(),
        ctaLink: ctaLinkEl.value.trim(),
        platforms: getPlatforms(),
        when,
        team: teamSelect.value,
        user: userSelect.value,
        role: roleSelect.value,
        approval: approvalEl.value,
        campaign: campaignEl.value.trim(),
        tags: tagsEl.value.trim(),
        status, // draft/pending/approved/scheduled/posted/rejected
        createdAt: new Date().toISOString()
      };
      return item;
    }

    function addRecurrence(baseItem){
      const freq = recurrenceEl.value;
      const end = repeatEndEl.value ? new Date(repeatEndEl.value) : null;
      if(freq === 'none' || !end) return [baseItem];

      const items = [baseItem];
      let cursor = new Date(baseItem.when);
      while(true){
        if(freq === 'daily') cursor.setDate(cursor.getDate()+1);
        if(freq === 'weekly') cursor.setDate(cursor.getDate()+7);
        if(freq === 'monthly') cursor.setMonth(cursor.getMonth()+1);
        if(end && cursor > end) break;
        const nextItem = { ...baseItem, id: uid(), when: cursor.toISOString(), status: baseItem.status };
        items.push(nextItem);
      }
      return items;
    }

    function renderQueue(filter='all'){
      queueEl.innerHTML = '';
      const filtered = queue
        .filter(it => filter==='all' ? true : it.status===filter)
        .sort((a,b)=> new Date(a.when) - new Date(b.when));

      if(!filtered.length){
        const empty = document.createElement('div');
        empty.className = 'muted';
        empty.textContent = 'No items.';
        queueEl.appendChild(empty);
        return;
      }

      filtered.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="meta">
            <div>
              <span class="badge">${sanitize(item.team)}</span>
              <span class="badge">${sanitize(item.user)}</span>
              <span class="badge">${sanitize(item.role)}</span>
              ${item.campaign ? `<span class="badge">${sanitize(item.campaign)}</span>`:''}
            </div>
            <div>
              <span>${fmtDate(item.when)}</span>
              <span class="status ${item.status}">• ${item.status}</span>
            </div>
          </div>
          <div>${sanitize(item.content).replace(/\n/g,'<br>')}</div>
          ${item.image ? `<img src="${item.image}" alt="Scheduled image" style="max-width:100%; border-radius:8px; border:1px solid #213046;">` : ''}
          <div class="badges">
            ${item.platforms.map(p=>`<span class="badge">${p}</span>`).join('')}
            ${item.tags ? `<span class="badge">tags: ${sanitize(item.tags)}</span>`:''}
            ${item.approval && item.approval!=='None' ? `<span class="badge">approval: ${sanitize(item.approval)}</span>`:''}
            ${item.ctaLink ? `<span class="badge">link</span>`:''}
          </div>
          <div class="row">
            <button class="btn secondary" data-action="edit" data-id="${item.id}">Edit</button>
            <button class="btn danger" data-action="delete" data-id="${item.id}">Delete</button>
            <button class="btn" data-action="approve" data-id="${item.id}">Approve</button>
            <button class="btn warn" data-action="reject" data-id="${item.id}">Reject</button>
            <button class="btn secondary" data-action="schedule" data-id="${item.id}">Schedule</button>
            <button class="btn" data-action="post" data-id="${item.id}">Mark posted</button>
          </div>
        `;
        queueEl.appendChild(div);
      });

      // Bind actions
      queueEl.querySelectorAll('button[data-action]').forEach(btn=>{
        const id = btn.getAttribute('data-id');
        const action = btn.getAttribute('data-action');
        btn.addEventListener('click', ()=>{
          const idx = queue.findIndex(x=>x.id===id);
          if(idx<0) return;
          const item = queue[idx];
          if(action==='delete'){ queue.splice(idx,1); saveQueue(queue); renderQueue(currentFilter); return; }
          if(action==='edit'){
            contentEl.value = item.content || '';
            imageEl.value = item.image || '';
            ctaLinkEl.value = item.ctaLink || '';
            scheduleEl.value = item.when.slice(0,16);
            campaignEl.value = item.campaign || '';
            tagsEl.value = item.tags || '';
            approvalEl.value = item.approval || 'None';
            platformInputs.forEach(cb => cb.checked = item.platforms.includes(cb.value));
            updatePreview();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
          }
          if(action==='approve'){ item.status='approved'; saveQueue(queue); renderQueue(currentFilter); return; }
          if(action==='reject'){ item.status='rejected'; saveQueue(queue); renderQueue(currentFilter); return; }
          if(action==='schedule'){ item.status='scheduled'; saveQueue(queue); renderQueue(currentFilter); return; }
          if(action==='post'){ item.status='posted'; saveQueue(queue); renderQueue(currentFilter); return; }
        });
      });
    }

    // Tabs / filter
    let currentFilter = 'all';
    tabs.forEach(t=>{
      t.addEventListener('click', ()=>{
        tabs.forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        currentFilter = t.dataset.filter;
        renderQueue(currentFilter);
      });
    });

    // Submit for approval
    submitBtn.addEventListener('click', ()=>{
      if(!validateBase()) return;
      const when = scheduleEl.value || new Date(Date.now()+3600_000).toISOString().slice(0,16); // default +1h
      const base = buildItem('pending', new Date(when).toISOString());
      const items = addRecurrence(base);
      queue.push(...items);
      saveQueue(queue);
      renderQueue(currentFilter);
      formError.textContent = 'Submitted for approval. (Local demo — integrate API to route approvals.)';
      clearComposer(false);
    });

    // Direct schedule
    scheduleBtn.addEventListener('click', ()=>{
      if(!validateBase() || !validateSchedule()) return;
      const base = buildItem('scheduled', new Date(scheduleEl.value).toISOString());
      const items = addRecurrence(base);
      queue.push(...items);
      saveQueue(queue);
      renderQueue(currentFilter);
      formError.textContent = 'Scheduled. (Local demo — integrate platform APIs to auto-post.)';
      clearComposer(false);
    });

    function clearComposer(resetPlatforms=true){
      contentEl.value=''; imageEl.value=''; ctaLinkEl.value='';
      scheduleEl.value=''; recurrenceEl.value='none'; repeatEndEl.value='';
      approvalEl.value='None'; tagsEl.value=''; campaignEl.value='';
      if(resetPlatforms) platformInputs.forEach(cb=>cb.checked=false);
      updatePreview(); formError.textContent='';
    }
    clearBtn.addEventListener('click', ()=> clearComposer());

    // Export
    exportBtn.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(queue,null,2)], { type:'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `firm-scheduler-${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.json`;
      a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    // Purge
    purgeBtn.addEventListener('click', ()=>{
      if(!confirm('Clear the entire queue?')) return;
      queue = []; saveQueue(queue); renderQueue(currentFilter);
    });

    // Templates
    saveTemplateBtn.addEventListener('click', ()=>{
      const tpl = {
        id: uid(),
        name: prompt('Template name?') || `Template ${new Date().toLocaleString()}`,
        content: contentEl.value.trim(),
        platforms: getPlatforms(),
        image: imageEl.value.trim(),
        ctaLink: ctaLinkEl.value.trim(),
        tags: tagsEl.value.trim()
      };
      templates.push(tpl);
      saveTemplates(templates);
      formError.textContent = `Saved template "${tpl.name}".`;
    });

    loadTemplateBtn.addEventListener('click', ()=>{
      if(!templates.length){ formError.textContent = 'No templates saved.'; return; }
      const names = templates.map((t,i)=>`${i+1}. ${t.name}`).join('\n');
      const idx = parseInt(prompt(`Pick a template number:\n${names}`)||'1',10)-1;
      const tpl = templates[idx];
      if(!tpl){ formError.textContent = 'Invalid selection.'; return; }
      contentEl.value = tpl.content||'';
      imageEl.value = tpl.image||'';
      ctaLinkEl.value = tpl.ctaLink||'';
      tagsEl.value = tpl.tags||'';
      platformInputs.forEach(cb=>cb.checked = (tpl.platforms||[]).includes(cb.value));
      updatePreview();
      formError.textContent = `Loaded template "${tpl.name}".`;
    });

    // CSV import: columns: content, platforms(comma), when(ISO or yyyy-mm-ddTHH:mm), image, ctaLink, team, user, approval, tags, campaign
    importCsvBtn.addEventListener('click', ()=> csvFile.click());
    csvFile.addEventListener('change', async ()=>{
      const file = csvFile.files[0]; if(!file) return;
      const text = await file.text();
      const rows = text.split(/\r?\n/).filter(Boolean);
      const header = rows.shift().split(',').map(h=>h.trim().toLowerCase());
      const idxOf = k => header.indexOf(k);
      const newItems = [];
      rows.forEach(line=>{
        const cols = line.split(',').map(x=>x.trim());
        const col = k => cols[idxOf(k)] || '';
        const platforms = (col('platforms')||'').split(';').map(x=>x.trim()).filter(Boolean);
        const whenStr = col('when') || new Date(Date.now()+3600_000).toISOString();
        const item = {
          id: uid(),
          content: col('content') || '',
          platforms: platforms.length?platforms:getPlatforms(),
          when: new Date(whenStr).toISOString(),
          image: col('image') || '',
          ctaLink: col('ctalink') || '',
          team: col('team') || teamSelect.value,
          user: col('user') || userSelect.value,
          role: roleSelect.value,
          approval: col('approval') || 'None',
          campaign: col('campaign') || '',
          tags: col('tags') || '',
          status: 'pending',
          createdAt: new Date().toISOString()
        };
        newItems.push(item);
      });
      queue.push(...newItems);
      saveQueue(queue); renderQueue(currentFilter);
      formError.textContent = `Imported ${newItems.length} items from CSV (as pending).`;
      csvFile.value = '';
    });

    // Init
    updatePreview();
    renderQueue(currentFilter);
  </script>
</body>
</html>